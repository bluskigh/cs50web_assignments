{% extends 'auctions/layout.html' %}
{% block title %}Viewing '{{ listing.title }}{% endblock %}
{% block body %}
{% if listing.owner.id != request.user.id %}
{% if listing.closed %}
{% if highest_bid.user.id == request.user.id %}
<p>You won the bid for this listing. Now pay up!</p>
{% endif %}
{% endif %}
{% if watching %}
<form action="{% url 'remove_watching' listing.id %}" method="POST">
    {% csrf_token %}
    <button class="button" type="submit">Remove from watch list</button>
</form>
{% else %}
<form action="{% url 'add_watching' listing.id %}" method="POST">
    {% csrf_token %}
    <button class="button" type="submit">Add to watch list</button>
</form>
{% endif %}
{% endif %}
<h1>Listing: {{ listing.title }}</h1>
{% if request.user.id != listing.owner.id %}
<!--if alreayd in watchlist then display option to remove from watchlist-->
<button>Add to watchlist</button> 
{% endif %}
{% if listing.image %}
<img src="{{ listing.image }}" height="350px" width="auto">
{% endif %}
<p>{{ listing.description }}</p>
<h3>{% if bids_length == 0 %}Starting bid price: {% else %}Current bid price: {% endif %}<strong>${{ highest_bid.amount }}</strong></h3>
<p>{{ bids_length }} bid(s). {% if highest_bid.user.id == request.user.id and highest_bid.user.id != listing.owner.id %}You're the current user with the highest bid.{% endif %}</p>
<!--display the total bids, and if the current bid is by the current user-->
<form action="{% url 'post_bid' listing.id %}" method="POST">
    {% csrf_token %}
    <input type="number" placeholder="Bid" min="{{ highest_bid.amount|add:1 }}" step=".01" name="amount" required value="{{ highest_bid.amount|add:1 }}"> 
    <button type="submit">Place Bid</button>
</form>
<h4>Details: </h4>
<ul>
    <li>Listed by: <a href="{% url 'user_view' listing.owner.id %}">{{ listing.owner.username }}</a></li>
    <li>Categories: {% if categories|length > 0 %}{% for category in categories %}{{ category.title }},{% endfor %}{% else %}No Categories.{% endif %}</li>
</ul>
{% if listing.owner.id == request.user.id %}
<form action="{% url 'close_listing' listing.id %}" method="POST">
    {% csrf_token %}
    <button type="submit">Close</button>
</form>
{% endif %}
{% endblock %}
